<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage PC - Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Admin Panel</h2>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <span class="icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="monitor.html" class="nav-item">
                    <span class="icon">üñ•Ô∏è</span>
                    <span>Monitor</span>
                </a>
                <a href="manage-pc.html" class="nav-item active">
                    <span class="icon">üíª</span>
                    <span>Manage PC</span>
                </a>
                <a href="manage-software.html" class="nav-item">
                    <span class="icon">üì¶</span>
                    <span>Software</span>
                </a>
                <a href="import-reservation.html" class="nav-item">
                    <span class="icon">üì•</span>
                    <span>Import Reservation</span>
                </a>
                <a href="reports.html" class="nav-item">
                    <span class="icon">üìà</span>
                    <span>Reports</span>
                </a>
            </nav>
            <div style="padding: var(--spacing-xl); border-top: 1px solid var(--border);">
                <a href="../user/idle.html?pc=PC-001" style="color: var(--text-secondary); font-size: 0.875rem;">
                    ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <div>
                    <h1>Manage Computers</h1>
                    <div class="breadcrumb">
                        <a href="dashboard.html">Admin</a>
                        <span>/</span>
                        <span>Manage PC</span>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="showAddPCModal()">
                    + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <!-- Search -->
            <div class="search-bar">
                <div class="search-input">
                    <span>üîç</span>
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ PC ID, Location...">
                </div>
            </div>

            <!-- PC Table -->
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>PC ID</th>
                            <th>Location</th>
                            <th>Status</th>
                            <th>Software</th>
                            <th>Last Maintenance</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="pcTableBody">
                        <!-- Rows will be loaded here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Add/Edit PC Modal -->
    <div class="modal" id="pcFormModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="formTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</h2>
                <button class="modal-close" onclick="closeFormModal()">√ó</button>
            </div>
            <form id="pcForm">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="pcId">PC ID *</label>
                        <input type="text" id="pcId" required placeholder="PC-001">
                    </div>
                    <div class="form-group">
                        <label for="location">Location *</label>
                        <input type="text" id="location" required placeholder="A1">
                    </div>
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status">
                            <option value="available">Available</option>
                            <option value="maintenance">Maintenance</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline" onclick="closeFormModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        let editingPCId = null;

        // Load PC Table
        function loadPCTable(searchTerm = '') {
            const computers = getComputers();
            const tbody = document.getElementById('pcTableBody');

            const filtered = searchTerm
                ? computers.filter(pc =>
                    pc.id.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    pc.location.toLowerCase().includes(searchTerm.toLowerCase())
                  )
                : computers;

            tbody.innerHTML = filtered.map(pc => `
                <tr>
                    <td><strong>${pc.id}</strong></td>
                    <td>${pc.location}</td>
                    <td>
                        <span class="badge badge-${pc.status === 'available' ? 'success' : pc.status === 'occupied' ? 'danger' : 'gray'}">
                            ${pc.status === 'available' ? '‡∏ß‡πà‡∏≤‡∏á' : pc.status === 'occupied' ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏ã‡πà‡∏≠‡∏°'}
                        </span>
                    </td>
                    <td>${pc.software ? pc.software.slice(0,2).join(', ') + (pc.software.length > 2 ? '...' : '') : '-'}</td>
                    <td>${pc.lastMaintenance || '-'}</td>
                    <td class="table-actions">
                        <button class="btn btn-sm btn-primary" onclick="editPC('${pc.id}')">
                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="generateQR('${pc.id}')">
                            QR Code
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deletePC('${pc.id}')">
                            ‡∏•‡∏ö
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Search
        document.getElementById('searchInput').addEventListener('input', function() {
            loadPCTable(this.value);
        });

        // Show Add PC Modal
        function showAddPCModal() {
            editingPCId = null;
            document.getElementById('formTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå';
            document.getElementById('pcForm').reset();
            document.getElementById('pcFormModal').classList.add('active');
        }

        // Edit PC
        function editPC(pcId) {
            const pc = getComputerById(pcId);
            editingPCId = pcId;

            document.getElementById('formTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå';
            document.getElementById('pcId').value = pc.id;
            document.getElementById('location').value = pc.location;
            document.getElementById('status').value = pc.status === 'occupied' ? 'available' : pc.status;

            document.getElementById('pcFormModal').classList.add('active');
        }

        // Save PC
        document.getElementById('pcForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = {
                id: document.getElementById('pcId').value,
                location: document.getElementById('location').value,
                status: document.getElementById('status').value
            };

            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...');

            setTimeout(() => {
                // In real app, save to database
                showAlert(editingPCId ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                hideLoading();
                closeFormModal();
                loadPCTable();
            }, 1000);
        });

        // Delete PC
        function deletePC(pcId) {
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ${pcId} ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...');
                setTimeout(() => {
                    const computers = getComputers();
                    const filtered = computers.filter(pc => pc.id !== pcId);
                    saveComputers(filtered);
                    hideLoading();
                    showAlert('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
                    loadPCTable();
                }, 1000);
            }
        }

        // Generate QR Code
        function generateQR(pcId) {
            alert(`QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ${pcId}\n\nURL: ${window.location.origin}/user/idle.html?pc=${pcId}`);
        }

        function closeFormModal() {
            document.getElementById('pcFormModal').classList.remove('active');
        }

        // Initialize
        loadPCTable();

        // Close modal on outside click
        document.getElementById('pcFormModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeFormModal();
            }
        });
    </script>
</body>
</html>
