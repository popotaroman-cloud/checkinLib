<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/admin.css">
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8"></script>
</head>
<body>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Admin Panel</h2>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå</p>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <span class="icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="monitor.html" class="nav-item">
                    <span class="icon">üñ•Ô∏è</span>
                    <span>Monitor</span>
                </a>
                <a href="manage-pc.html" class="nav-item">
                    <span class="icon">üíª</span>
                    <span>Manage PC</span>
                </a>
                <a href="manage-software.html" class="nav-item">
                    <span class="icon">üì¶</span>
                    <span>Software</span>
                </a>
                <a href="import-reservation.html" class="nav-item">
                    <span class="icon">üì•</span>
                    <span>Import Reservation</span>
                </a>
                <a href="reports.html" class="nav-item active">
                    <span class="icon">üìà</span>
                    <span>Reports</span>
                </a>
            </nav>
            <div style="padding: var(--spacing-xl); border-top: 1px solid var(--border);">
                <a href="../user/idle.html?pc=PC-001" style="color: var(--text-secondary); font-size: 0.875rem;">
                    ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="content-header">
                <div>
                    <h1>Reports & Statistics</h1>
                    <div class="breadcrumb">
                        <a href="dashboard.html">Admin</a>
                        <span>/</span>
                        <span>Reports</span>
                    </div>
                </div>
                <button class="btn btn-success" onclick="exportCSV()">
                    üì• Export CSV
                </button>
            </div>

            <!-- Filter Panel -->
            <div class="filter-panel">
                <h3 style="margin-bottom: 1rem;">Filter Data</h3>
                <div class="filter-grid">
                    <div class="form-group">
                        <label for="startDate">Start Date</label>
                        <input type="date" id="startDate" value="2024-11-20">
                    </div>
                    <div class="form-group">
                        <label for="endDate">End Date</label>
                        <input type="date" id="endDate" value="2024-11-28">
                    </div>
                    <div class="form-group">
                        <label for="userType">User Type</label>
                        <select id="userType">
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="internal">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤/‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option>
                            <option value="external">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="faculty">Faculty</label>
                        <select id="faculty">
                            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                            <option value="‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                            <option value="‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Ñ‡∏£‡∏∏‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="updateCharts()">
                    üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
                </button>
            </div>

            <!-- Charts -->
            <div class="charts-container">
                <!-- Chart 1: Usage by Hour -->
                <div class="chart-card">
                    <h3>‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h3>
                    <div id="hourlyChart"></div>
                </div>

                <!-- Chart 2: Usage by Faculty -->
                <div class="chart-card">
                    <h3>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ì‡∏∞</h3>
                    <div id="facultyChart"></div>
                </div>

                <!-- Chart 3: Daily Trend -->
                <div class="chart-card">
                    <h3>Trend ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                    <div id="trendChart"></div>
                </div>

                <!-- Chart 4: Rating -->
                <div class="chart-card">
                    <h3>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏∂‡∏á‡∏û‡∏≠‡πÉ‡∏à‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</h3>
                    <div id="ratingChart"></div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script>
        function updateCharts() {
            createHourlyChart();
            createFacultyChart();
            createTrendChart();
            createRatingChart();
        }

        // Chart 1: Hourly Usage
        function createHourlyChart() {
            const hours = Array.from({length: 12}, (_, i) => `${8+i}:00`);
            const usage = [5, 8, 12, 15, 20, 18, 22, 25, 20, 15, 10, 8];

            const data = [{
                x: hours,
                y: usage,
                type: 'bar',
                marker: {color: '#3b82f6'}
            }];

            const layout = {
                xaxis: {title: '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á'},
                yaxis: {title: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ'},
                margin: {t: 20}
            };

            Plotly.newPlot('hourlyChart', data, layout, {responsive: true});
        }

        // Chart 2: Faculty Distribution
        function createFacultyChart() {
            const logs = getUsageLogs().filter(log => log.userType === 'internal');

            const facultyCount = {};
            logs.forEach(log => {
                facultyCount[log.faculty] = (facultyCount[log.faculty] || 0) + 1;
            });

            const data = [{
                values: Object.values(facultyCount),
                labels: Object.keys(facultyCount),
                type: 'pie'
            }];

            const layout = {
                margin: {t: 20}
            };

            Plotly.newPlot('facultyChart', data, layout, {responsive: true});
        }

        // Chart 3: Daily Trend
        function createTrendChart() {
            const days = ['20 ‡∏û.‡∏¢.', '21 ‡∏û.‡∏¢.', '22 ‡∏û.‡∏¢.', '23 ‡∏û.‡∏¢.', '24 ‡∏û.‡∏¢.', '25 ‡∏û.‡∏¢.', '26 ‡∏û.‡∏¢.', '27 ‡∏û.‡∏¢.'];
            const users = [45, 52, 48, 60, 55, 58, 50, 62];

            const data = [{
                x: days,
                y: users,
                type: 'scatter',
                mode: 'lines+markers',
                line: {color: '#8b5cf6'}
            }];

            const layout = {
                xaxis: {title: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà'},
                yaxis: {title: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ'},
                margin: {t: 20}
            };

            Plotly.newPlot('trendChart', data, layout, {responsive: true});
        }

        // Chart 4: Rating
        function createRatingChart() {
            const logs = getUsageLogs().filter(log => log.rating);

            const ratingCount = [0, 0, 0, 0, 0];
            logs.forEach(log => {
                if (log.rating >= 1 && log.rating <= 5) {
                    ratingCount[log.rating - 1]++;
                }
            });

            const data = [{
                x: ['1 ‡∏î‡∏≤‡∏ß', '2 ‡∏î‡∏≤‡∏ß', '3 ‡∏î‡∏≤‡∏ß', '4 ‡∏î‡∏≤‡∏ß', '5 ‡∏î‡∏≤‡∏ß'],
                y: ratingCount,
                type: 'bar',
                marker: {color: ['#ef4444', '#f59e0b', '#eab308', '#84cc16', '#10b981']}
            }];

            const layout = {
                xaxis: {title: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô'},
                yaxis: {title: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô'},
                margin: {t: 20}
            };

            Plotly.newPlot('ratingChart', data, layout, {responsive: true});
        }

        function exportCSV() {
            const logs = getUsageLogs();
            exportToCSV(logs, 'usage_report_' + new Date().toISOString().split('T')[0] + '.csv');
            showAlert('‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // Initialize
        updateCharts();
    </script>
</body>
</html>
